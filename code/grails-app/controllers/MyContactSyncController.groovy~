import grails.transaction.*
import static org.springframework.http.HttpStatus.*
import static org.springframework.http.HttpMethod.*
import groovy.sql.Sql
import grails.converters.JSON
import groovy.json.JsonBuilder

class MyContactSyncController  {
    def dataSource
    def index = {
 	render "Call /myContactSyncController/show"
    }
    	def show1 = {
    	def db = new Sql(dataSource)
	def phone = params.pn
	def uid = params.uid	
	println phone
	println uid	
	println (phone && uid)	
	def query
	def schedule_data
        if (phone && uid) 
        {	
	List data = []	
	def builder = new groovy.json.JsonBuilder()
	try {
	String sqlString = "select user_id,user_following_id,phone from user_user, user where user.id=user_following_id and  user_following_id in (select id from user where phone in ("  + phone + "))" + " and user_id="+uid
	println sqlString
   	db.eachRow(sqlString) {
	data << "user_id:" + it.user_id +  ":user_following_id:" +  it.user_following_id + "phone:" +  it.phone
       	println data 
	
	} //db.eachRow
	
	//render data as JSON
	println builder
	render builder	
	//show2
	} //end try
	catch (Exception e) {
	//e.printStackTrace()
	render "ERROR SQL ERROR SHOW1"		
	} //end catch
	} //end if
	else { render "ERROR NO PARAMS SHOW1" }
} //end show1
	def show2 = {
    	def db = new Sql(dataSource)
	def phone = params.pn
	def uid = params.uid	
	println phone
	println uid	
	def query
	def schedule_data
        if (phone && uid) 
        {	
	List data = []	
	try {
	String sqlString1 = "select id,phone from user where phone in ("+phone+")"
	println sqlString1
	println data
   	db.eachRow(sqlString1) {
	data << "user_id:" + it.id +  ":phone:" +  it.phone 
       	println data 
	builder.call(data)
	} //db.each
	render data as JSON
	} //end try
	 catch (Exception e) {
        //e.printStackTrace()
        render "ERROR SQL ERROR SHOW2"
        } //end catch
	} //end if
	else { render "ERROR NO PARAMS SHOW2" }
   } //end show2
}

